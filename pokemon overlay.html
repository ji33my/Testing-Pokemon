<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pokémon Timer</title>
<style>
  body {
    background: transparent;
    color: white;
    font-family: Arial, sans-serif;
    text-align: center;
    font-size: 48px;
  }
  #label {
    font-size: 24px;
    margin-top: 10px;
  }
</style>
</head>
<body>
<div id="timer">00:00:00</div>
<div id="label">Time until next Pokémon</div>

<script>
const apiUrl = "https://poketwitch.bframework.de/info/events/last_spawn/?t=1";
let nextSpawn = null;

async function fetchNextSpawn() {
    try {
        const response = await fetch(apiUrl);
        const data = await response.json();
        
        // last_spawn_time should be in ISO format
        const lastSpawn = new Date(data.last_spawn_time);
        nextSpawn = new Date(lastSpawn.getTime() + 5 * 60 * 1000); // next spawn 5 minutes later
    } catch (err) {
        console.error("Error fetching API:", err);
        // If API fails, retry in 10 seconds
        setTimeout(fetchNextSpawn, 10000);
    }
}

function updateTimer() {
    if(!nextSpawn) return;

    const now = new Date();
    let diff = nextSpawn - now;

    if(diff <= 0) {
        // Time's up, fetch new spawn
        fetchNextSpawn();
        diff = 0;
    }

    const hours = String(Math.floor(diff / 3600000)).padStart(2, '0');
    const minutes = String(Math.floor((diff % 3600000) / 60000)).padStart(2, '0');
    const seconds = String(Math.floor((diff % 60000) / 1000)).padStart(2, '0');

    document.getElementById("timer").textContent = `${hours}:${minutes}:${seconds}`;
}

// Start everything
(async function() {
    await fetchNextSpawn();
    setInterval(updateTimer, 1000);
})();
</script>
</body>
</html>
