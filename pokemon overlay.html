<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pokémon Timer</title>
<style>
  body {
    background: transparent;
    color: white;
    font-family: Arial, sans-serif;
    text-align: center;
    font-size: 48px;
  }
  #label {
    font-size: 24px;
    margin-top: 10px;
  }
</style>
</head>
<body>
<div id="timer">00:00:00</div>
<div id="label">Time until next Pokémon</div>

<script>
const apiUrl = "https://poketwitch.bframework.de/info/events/last_spawn/?t=1";

async function getNextPokemonTime() {
    try {
        const response = await fetch(apiUrl);
        const data = await response.json();
        
        // API returns the last spawn time in UTC, format example: "2026-02-07T04:12:34.000Z"
        const lastSpawn = new Date(data.last_spawn_time);
        const nextSpawn = new Date(lastSpawn.getTime() + 300000); // 5 minutes later (300,000 ms)
        return nextSpawn;
    } catch (err) {
        console.error("Error fetching API:", err);
        return null;
    }
}

function startTimer(nextSpawn) {
    const timerDiv = document.getElementById("timer");
    
    function update() {
        const now = new Date();
        let diff = nextSpawn - now;

        if(diff < 0) diff = 0;

        const hours = String(Math.floor(diff / 3600000)).padStart(2, '0');
        const minutes = String(Math.floor((diff % 3600000) / 60000)).padStart(2, '0');
        const seconds = String(Math.floor((diff % 60000) / 1000)).padStart(2, '0');

        timerDiv.textContent = `${hours}:${minutes}:${seconds}`;

        requestAnimationFrame(update);
    }

    update();
}

// Initialize
(async function() {
    const nextSpawn = await getNextPokemonTime();
    if(nextSpawn) startTimer(nextSpawn);
})();
</script>
</body>
</html>
